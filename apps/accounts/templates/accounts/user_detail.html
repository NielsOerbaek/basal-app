{% extends 'core/base.html' %}

{% block title %}{{ user_obj.username }} - Basal{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'accounts:user-list' %}">Brugere</a></li>
        <li class="breadcrumb-item active">{{ user_obj.get_full_name|default:user_obj.username }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-person me-2"></i>{{ user_obj.username }}</h1>
    <div>
        <button type="button" class="btn btn-outline-warning me-2" data-bs-toggle="modal" data-bs-target="#resetPasswordModal" {% if not user_obj.email %}disabled title="Brugeren har ingen e-mailadresse"{% endif %}>
            <i class="bi bi-key me-1"></i>Nulstil adgangskode
        </button>
        <a href="{% url 'accounts:user-update' user_obj.pk %}" class="btn btn-outline-primary">
            <i class="bi bi-pencil me-1"></i>Rediger
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">Brugernavn</dt>
            <dd class="col-sm-9">{{ user_obj.username }}</dd>
            <dt class="col-sm-3">Fulde navn</dt>
            <dd class="col-sm-9">{{ user_obj.get_full_name|default:"-" }}</dd>
            <dt class="col-sm-3">E-mail</dt>
            <dd class="col-sm-9">{{ user_obj.email|default:"-" }}</dd>
            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">
                {% if user_obj.is_active %}
                <span class="badge bg-success">Aktiv</span>
                {% else %}
                <span class="badge bg-secondary">Inaktiv</span>
                {% endif %}
            </dd>
            <dt class="col-sm-3">Rettigheder</dt>
            <dd class="col-sm-9">
                {% if user_obj.is_superuser %}
                <span class="badge bg-danger">Fuld administrator</span>
                {% else %}
                    {% with user_obj.groups.all as groups %}
                        {% for group in groups %}
                            {% if group.name == 'Brugeradministrator' %}
                            <span class="badge bg-primary">Brugeradministrator</span>
                            {% elif group.name == 'Tilmeldingsadministrator' %}
                            <span class="badge bg-info">Tilmeldingsadministrator</span>
                            {% endif %}
                        {% empty %}
                        <span class="badge bg-secondary">Basisbruger</span>
                        {% endfor %}
                    {% endwith %}
                {% endif %}
            </dd>
            <dt class="col-sm-3">Oprettet</dt>
            <dd class="col-sm-9">{{ user_obj.date_joined|date:"d. M Y H:i" }}</dd>
            <dt class="col-sm-3">Sidste login</dt>
            <dd class="col-sm-9">{{ user_obj.last_login|date:"d. M Y H:i"|default:"Aldrig" }}</dd>
        </dl>
    </div>
</div>

<!-- Reset Password Modal -->
<div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-labelledby="resetPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resetPasswordModalLabel">
                    <i class="bi bi-exclamation-triangle text-warning me-2"></i>Nulstil adgangskode
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Luk"></button>
            </div>
            <div class="modal-body">
                <p>Er du sikker på, at du vil nulstille adgangskoden for <strong>{{ user_obj.username }}</strong>?</p>
                <p class="mb-0">En ny adgangskode vil blive genereret og sendt til:</p>
                <p><strong>{{ user_obj.email }}</strong></p>
                <div class="alert alert-warning mb-0">
                    <i class="bi bi-info-circle me-1"></i>
                    Brugerens nuværende adgangskode vil blive erstattet med den nye.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuller</button>
                <form method="post" action="{% url 'accounts:user-reset-password' user_obj.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning">
                        <i class="bi bi-key me-1"></i>Nulstil og send e-mail
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
