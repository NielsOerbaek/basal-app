services:
  # Main web service
  - type: web
    name: basal
    runtime: docker
    plan: starter  # $7/mo, or use 'free' for free tier (has cold starts)
    healthCheckPath: /login/
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: config.settings.production
      - key: SECRET_KEY
        generateValue: true
      - key: ALLOWED_HOSTS
        sync: false  # Set manually after first deploy: basal-xxxx.onrender.com
      - key: DATABASE_URL
        sync: false  # Your Supabase connection string
      - key: RESEND_API_KEY
        sync: false
      - key: DEFAULT_FROM_EMAIL
        sync: false
      - key: CRON_SECRET
        generateValue: true

  # Cron job for sending course reminders (daily at 08:00 UTC)
  - type: cron
    name: basal-send-reminders
    runtime: image
    image:
      url: curlimages/curl:latest
    schedule: "0 8 * * *"
    envVars:
      - key: APP_URL
        sync: false  # Set to https://basal-xxxx.onrender.com
      - key: CRON_SECRET
        fromService:
          type: web
          name: basal
          envVarKey: CRON_SECRET
    buildCommand: ""
    startCommand: curl -f -H "Authorization: Bearer $CRON_SECRET" "$APP_URL/cron/send-reminders/"
